!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e):"function"==typeof define&&define.amd?define("throbber",[],function(){return t(e)}):e.Throbber=t(e)}(window||this,function(e){function t(e){if(!(this instanceof t))return new t(e);var i=this.elem=l.createElement("canvas"),n=this;isNaN(e)||(e={size:e}),this.o={size:34,rotationspeed:6,clockwise:!0,color:"#fff",fade:300,fallback:!1,alpha:1},this.configure(e),this.phase=-1,h?(this.ctx=i.getContext("2d"),i.width=i.height=this.o.size):this.o.fallback&&(i=this.elem=new Image,i.src=this.o.fallback),this.loop=function(){var e=n.o,t=0,o=1e3/e.fade/e.fps,s=(1e3/e.fps,n.step),a=i.style,l=i.currentStyle,p=(l&&l.filter||a.filter,"filter"in a&&e.fallback&&!h);return function(){3==n.phase&&(t-=o,0>=t&&(n.phase=0)),1==n.phase&&(t+=o,t>=1&&(n.phase=2)),p?a.filter="alpha(opacity="+r.min(100*e.alpha,r.max(0,Math.round(100*t)))+")":!h&&e.fallback?a.opacity=t:h&&(d(t,e,n.ctx,s),s=0===s?n.o.lines:s-1)}}(),c(this.o.fps,this.loop)}var i,n,o,s,a,l=e.document,r=Math,h=(e.setTimeout,"getContext"in l.createElement("canvas")),p=function(e,t){e=e||{};for(var i in t)e[i]=t[i];return e},c=function(){function t(){o(t);for(var e=+new Date,n=0;n<i.length;n++){var s=i[n];s.elapsed=e-s.then,s.elapsed>s.fpsInterval&&(s.then=e-s.elapsed%s.fpsInterval,s.fn())}}var i=[],n=!1,o=function(){var t="RequestAnimationFrame";return e.requestAnimationFrame||e["webkit"+t]||e["moz"+t]||e["o"+t]||e["ms"+t]||function(t){e.setTimeout(t,1e3/60)}}();return function(e,o){var s=+new Date;i.push({fpsInterval:1e3/e,then:s,startTime:s,elapsed:0,fn:o}),n||(n=!0,t())}}(),f=function(t){if(!h)return{rgb:!1,alpha:1};var i,n=l.createElement("i");return n.style.display="none",n.style.color=t,l.body.appendChild(n),i=e.getComputedStyle(n,null).getPropertyValue("color").replace(/^rgba?\(([^\)]+)\)/,"$1").replace(/\s/g,"").split(",").splice(0,4),l.body.removeChild(n),n=null,{alpha:4==i.length?i.pop():1,rgb:i}},u=function(e,t,i){var n=i?-2:2;e.translate(t/n,t/n)},d=function(e,t,l,h){i=1-e||0,s=1,a=-1;var p=t.size;for(t.clockwise===!1&&(s=-1,a=1),l.clearRect(0,0,p,p),l.globalAlpha=t.alpha,l.lineWidth=t.strokewidth,n=0;n<t.lines;n++)o=n+h>=t.lines?n-t.lines+h:n+h,l.strokeStyle="rgba("+t.color.join(",")+","+r.max(0,o/t.lines-i).toFixed(2)+")",l.beginPath(),l.moveTo(p/2,p/2-t.padding/2),l.lineTo(p/2,0),l.lineWidth=t.strokewidth,l.stroke(),u(l,p,!1),l.rotate(s*(360/t.lines)*r.PI/180),u(l,p,!0);t.rotationspeed&&(l.save(),u(l,p,!1),l.rotate(a*(360/t.lines/(20-2*t.rotationspeed))*r.PI/180),u(l,p,!0))};return t.prototype={constructor:t,appendTo:function(e){return this.elem.style.display="none",e.appendChild(this.elem),this},configure:function(t){var i,n=this.o;return p(n,t||{}),i=f(n.color),p(n,p({padding:n.size/2,strokewidth:r.max(1,r.min(n.size/30,3)),lines:r.min(30,n.size/2+4),alpha:i.alpha||1,fps:r.min(30,n.size+4)},t)),n.color=i.rgb,this.step=n.lines,e.devicePixelRatio&&(this.elem.style.width=n.size+"px",this.elem.style.height=n.size+"px",n.size*=e.devicePixelRatio,n.padding*=e.devicePixelRatio,n.strokewidth*=e.devicePixelRatio),this},start:function(){return this.elem.style.display="block",-1==this.phase&&this.loop(),this.phase=1,this},stop:function(){return this.phase=3,this},toggle:function(){2==this.phase?this.stop():this.start()}},t});